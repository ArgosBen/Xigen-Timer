!function(){"use strict";var t={TEXT_ELEMENT:"span",ACTIVE_CLASS:"is-open",BREADCRUMB_CLASS:".breadcrumbs",CLEAR_CLASS:".do-clearfilter"};XIGENTIMER.ProjectFilter=function(t,e){return!this instanceof XIGENTIMER.ProjectFilter?new XIGENTIMER.ProjectFilter(arguments):(this.list=t.jquery?t:$(t),this.input=e.jquery?e:$(e),this.setup(),this.addHandlers(),void 0)},XIGENTIMER.ProjectFilter.prototype.setup=function(){var t=this;this.elements=[],$.each(this.list.children("li"),function(){t.elements.push({el:this,text:$(this).children("span").first().text()}),this.remove()}),this.showElements(this.matchText($(this.input).val()))},XIGENTIMER.ProjectFilter.prototype.refresh=function(e){this.setup(),this.draw(),$("span",this.list).each(function(){e.indexOf($(this).text())>-1&&($(this).addClass(t.ACTIVE_CLASS),$(this).parent("li").children("ul").toggle())})},XIGENTIMER.ProjectFilter.prototype.matchText=function(t){return t?this.elements.filter(function(e){return e.text.toLowerCase().indexOf(t.toLowerCase())>-1}):this.elements},XIGENTIMER.ProjectFilter.prototype.showElements=function(e){var i=this;i.list.empty(),$.each(e,function(){i.list.append(this.el)}),$("span",this.list).removeClass(t.ACTIVE_CLASS),this.draw()},XIGENTIMER.ProjectFilter.prototype.addHandlers=function(){var e=this;this.input.on("keyup",function(){e.showElements(e.matchText($(this).val()))}),$(t.CLEAR_CLASS).on("click",function(){$(e.input).val(""),e.showElements(e.matchText($(e.input).val()))}),$(this.list).on("click","li span",function(){$(this).toggleClass(t.ACTIVE_CLASS),$(this).parent("li").children("ul").toggle()})},XIGENTIMER.ProjectFilter.prototype.draw=function(){$("li ul",this.list).hide();var e,i,s,n,a,r,l=$(t.BREADCRUMB_CLASS),o=[];XIGENTIMER.BREADCRUMB_EMPTY||(XIGENTIMER.BREADCRUMB_CONTAINER=l,XIGENTIMER.BREADCRUMB_EMPTY=l.contents()),$(this.list).on("click","a",function(t){t.preventDefault(),i=parseInt($(this).parents("li").attr("data-id"),10),r=this,o=[],a=$(r).find(".label"),a.hasClass("alert")?XIGENTIMER.VIEWMODEL.taskTypeID(2):a.hasClass("success")?XIGENTIMER.VIEWMODEL.taskTypeID(3):XIGENTIMER.VIEWMODEL.taskTypeID(1),$(r).parents("li").each(function(){o.push($(this).find("span").first().text())}),o=o.filter(function(t){return""!==t}).reverse(),l.empty(),$(o).each(function(t){t!==o.length-1?l.append("<li class='unavailable'><a href='#'>"+this+"</a></li>"):l.append("<li class='current'><a href='#'>"+this+"</a></li>")}),$("[data-estimate]").text(s||"Working..."),$("[data-sofar]").text(n||"Working..."),XIGENTIMER.VIEWMODEL.selectedProject(i),localforage.getItem("activityCache",function(t){e=t.filter(function(t){return t.EntityBaseID===i})[0],s=e.EstimatedHours?e.EstimatedHours.toFixed(2):!1,XIGENTIMER.API.getTimeForTask(i,function(t){n=t.toFixed(2),$("[data-estimate]").text(s||"0.00"),$("[data-sofar]").text(n||"---")})})})}}();