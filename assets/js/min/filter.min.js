!function(){"use strict";var t,e={TEXT_ELEMENT:"span",ACTIVE_CLASS:"is-open",BREADCRUMB_CLASS:".breadcrumbs",CLEAR_CLASS:".do-clearfilter"},i=require("nw.gui"),n=new i.Menu;n.append(new i.MenuItem({label:"Log time on this item"})),n.append(new i.MenuItem({label:"View in browser"})),t=function(t){localforage.getItem("baseURL",function(e){XIGENTIMER.launchExternal(e+"/TaskDetails.aspx?ID="+t)})},XIGENTIMER.ProjectFilter=function(t,e){return!this instanceof XIGENTIMER.ProjectFilter?new XIGENTIMER.ProjectFilter(arguments):(this.list=t.jquery?t:$(t),this.input=e.jquery?e:$(e),this.setup(),this.addHandlers(),void 0)},XIGENTIMER.ProjectFilter.prototype.setup=function(){var t=this;this.elements=[],$.each(this.list.children("li"),function(){t.elements.push({el:this,text:$(this).children("span").first().text()}),this.remove()}),this.showElements(this.matchText($(this.input).val()))},XIGENTIMER.ProjectFilter.prototype.refresh=function(t){this.setup(),this.draw(),$("span",this.list).each(function(){t.indexOf($(this).text())>-1&&($(this).addClass(e.ACTIVE_CLASS),$(this).parent("li").children("ul").toggle())})},XIGENTIMER.ProjectFilter.prototype.matchText=function(t){return t?this.elements.filter(function(e){return e.text.toLowerCase().indexOf(t.toLowerCase())>-1}):this.elements},XIGENTIMER.ProjectFilter.prototype.showElements=function(t){var i=this;i.list.empty(),$.each(t,function(){i.list.append(this.el)}),$("span",this.list).removeClass(e.ACTIVE_CLASS),this.draw()},XIGENTIMER.ProjectFilter.prototype.addHandlers=function(){var i=this;this.input.on("keyup",function(t){9!==t.which&&i.showElements(i.matchText($(this).val()))}),$(e.CLEAR_CLASS).on("click",function(){$(i.input).val(""),i.showElements(i.matchText($(i.input).val()))}),$(this.list).on("click","li span",function(){$(this).toggleClass(e.ACTIVE_CLASS),$(this).parent("li").children("ul").toggle()}),$(document).on("contextmenu",function(e){return $(e.target).parents("ul").length>1?(e.preventDefault(),n.items[1].click=function(){t($(e.target).closest("li").attr("data-id"))},n.items[0].click=function(){i.selectActivity(e.target)},n.popup(e.originalEvent.x,e.originalEvent.y),!1):void 0})},XIGENTIMER.ProjectFilter.prototype.draw=function(){$("li ul",this.list).hide();var t=$(e.BREADCRUMB_CLASS),i=this;XIGENTIMER.BREADCRUMB_EMPTY||(XIGENTIMER.BREADCRUMB_CONTAINER=t,XIGENTIMER.BREADCRUMB_EMPTY=t.contents()),$(this.list).on("click","a",function(t){t.preventDefault(),i.selectActivity(this)})},XIGENTIMER.ProjectFilter.prototype.selectActivity=function(t){var e,i,n,s=parseInt($(t).parents("li").attr("data-id"),10),a=t,r=[],l=$(t).find(".label"),o=XIGENTIMER.BREADCRUMB_CONTAINER;l.hasClass("alert")?XIGENTIMER.VIEWMODEL.taskTypeID(2):l.hasClass("success")?XIGENTIMER.VIEWMODEL.taskTypeID(3):XIGENTIMER.VIEWMODEL.taskTypeID(1),$(a).parents("li").each(function(){r.push($(this).find("span").first().text())}),r=r.filter(function(t){return""!==t}).reverse(),o.empty(),$(r).each(function(t){t!==r.length-1?o.append("<li class='unavailable'><a href='#'>"+this+"</a></li>"):o.append("<li class='current'><a href='#'>"+this+"</a></li>")}),$("[data-estimate]").text(e||"Working..."),$("[data-sofar]").text(i||"Working..."),XIGENTIMER.VIEWMODEL.selectedProject(s),localforage.getItem("activityCache",function(t){n=t.filter(function(t){return t.EntityBaseID===s})[0]||{},e=n.EstimatedHours?n.EstimatedHours.toFixed(2):!1,XIGENTIMER.API.getTimeForTask(s,function(t){i=t.toFixed(2),$("[data-estimate]").text(e||"0.00"),$("[data-sofar]").text(i||"---")})})}}();