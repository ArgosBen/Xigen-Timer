$(function(){"use strict";function e(e,t){console.log("Authorizing (level 1) with "+e),console.log("Authorizing (level 1) with user "+t),XIGENTIMER.API.authorizeUser(e,t,function(e){e?(localforage.setItem("user",e),$("[data-avatar]").find("img").remove(),$("[data-avatar]").prepend("<img src='"+l+"&h="+e.AvatarHash+"&id="+e.UserID+"'/>"),n(),s.isLoggedOut(!1),s.isLoggedIn(!0)):(o.text("Incorrect login, try again! :)").addClass("warning").removeClass("info"),setTimeout(function(){o.text(a).addClass("info").removeClass("warning")},3e3))})}function t(e){var t=$(document.createElement("ul"));return $.each(e,function(){t.append("<li><a href='#'>"+this.Name+"</a></li>")}),t}function n(){XIGENTIMER.API.getProjects(function(e){var n,a,o,s=$(".side-nav"),l=document.createDocumentFragment();s.empty(),$.each(e.filter(function(e){return e.Activities.length>0}),function(e,i){n=$(document.createElement("li")),n.append("<span>"+i.Name+"</span>"),i.Activities&&i.Activities.length>0&&(a=$(document.createElement("ul")),$.each(i.Activities.filter(function(e){return!e.isHidden}),function(e,n){n.Activities?(o=$("<li><span>"+n.Name+"</span></li>"),o.append(t(n.Activities)),a.append(o)):a.append("<li><a href='#'>"+n.Name+"</a></li>")}),n.append(a)),l.appendChild(n[0])}),s[0].appendChild(l),i()})}function i(){$(".side-nav li ul").hide(),$(".side-nav li").each(function(){$(this).children("span").on("click",function(){$(this).parent("li").children("ul").toggle()})})}var a,o,s,l="http://projects.xigen.co.uk/ImagePage.aspx?t=0",r=$(".timer").FlipClock({autoStart:!1}),c=!1;$(document).foundation(),XIGENTIMER.loginForm=function(){this.isLoggedIn=ko.observable(!1),this.isLoggedOut=ko.observable(!0),localforage.getItem("authToken",function(t){t&&localforage.getItem("userName",function(n){n&&t&&e(t,n)})}),$("[data-login]").on("submit",function(t){t.preventDefault();var n,i=$("[name=password]",this).val(),s=$("[name=user]",this).val();o=$("[type=submit]",this),a=o.text(),n="Basic "+new Buffer(s+":"+i).toString("base64"),localforage.setItem("authToken",n),localforage.setItem("userName",s),o.text("Logging in..."),e(n,s)}),$("[data-logout]").on("click",function(e){e.preventDefault(),localforage.setItem("authToken",null),localforage.setItem("userName",null),$("[data-login]")[0].reset(),s.isLoggedOut(!0),s.isLoggedIn(!1)})},s=new XIGENTIMER.loginForm,ko.applyBindings(s),$(".do-timestart").on("click",function(){c?(c=!1,$(".do-timestart").text("Start"),r.stop(),console.log(r.getTime())):(c=!0,$(".do-timestart").text("Pause"),r.start())})});