$(function(){"use strict";function e(e,s){XIGENTIMER.API.authorizeUser(e,s,function(e){e?(localforage.setItem("user",e),$("[data-avatar]").find("img").remove(),$("[data-avatar]").prepend("<img src='"+i+"&h="+e.AvatarHash+"&id="+e.UserID+"'/>"),XIGENTIMER.updateProjectList(function(){n||(n=new XIGENTIMER.ProjectFilter($(".side-nav"),$(".sidebar-filter-wrap input")),setInterval(function(){XIGENTIMER.updateProjectList(function(e){console.log("Refreshed..."),n.refresh(e)})},6e5))}),o.isLoggedOut(!1),o.isLoggedIn(!0)):(o.isLoggedOut(!0),a.text("Incorrect login, try again! :)").addClass("warning").removeClass("info"),setTimeout(function(){a.text(t).addClass("info").removeClass("warning")},3e3))})}var t,o,n,i="http://projectsvm.xigen.co.uk/ImagePage.aspx?t=0",a=$(".login [type=submit]");$(document).foundation(),XIGENTIMER.loginForm=function(){var n=this;this.isLoggedIn=ko.observable(!1),this.isLoggedOut=ko.observable(!1),this.selectedProject=ko.observable(!1),this.isTiming=ko.observable(!1),this.activityDesc=ko.observable(""),this.dummy=ko.observable(),this.hasProjectSelected=ko.computed(function(){return!!n.selectedProject()}),this.canEdit=ko.computed(function(){return!n.isTiming()}),this.canSendTime=ko.computed(function(){return n.dummy(),!!n.activityDesc()&&!n.isTiming()&&XIGENTIMER.TIMER.getTime()>0&&!!n.selectedProject()}),this.recalcCanSend=function(){n.dummy.notifySubscribers()},localforage.getItem("authToken",function(t){t&&localforage.getItem("userName",function(o){o&&t&&e(t,o)})}),$("[data-login]").on("submit",function(o){o.preventDefault();var n,i=$("[name=password]",this).val(),s=$("[name=user]",this).val();t=a.text(),n="Basic "+new Buffer(s+":"+i).toString("base64"),localforage.setItem("authToken",n),localforage.setItem("userName",s),a.text("Logging in..."),e(n,s)}),$("[data-logout]").on("click",function(e){e.preventDefault(),localforage.setItem("authToken",null),localforage.setItem("userName",null),$("[data-login]")[0].reset(),o.isLoggedOut(!0),o.isLoggedIn(!1),a.text(t)})},o=new XIGENTIMER.loginForm,ko.applyBindings(o),XIGENTIMER.VIEWMODEL=o,$(".do-reset").on("click",function(){XIGENTIMER.reset()}),$(".do-viewonline").on("click",function(){XIGENTIMER.launchExternal("http://projects.xigen.co.uk/TaskDetails.aspx?ID="+o.selectedProject())})});