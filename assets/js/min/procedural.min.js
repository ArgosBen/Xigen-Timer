$(function(){"use strict";var e,t,n,a=$(".login [type=submit]"),o=[];$(document).foundation(),$(".login").hide(),$(".datepicker").each(function(){t=new Pikaday({field:this,firstDay:1,defaultDate:new Date,setDefaultDate:!0,maxDate:new Date,format:"D MMM YYYY",onSelect:function(){XIGENTIMER.updateDatePickers()}}),$(this).data("picker",t),o.push(t)}),$("[data-logout]").on("click",function(e){e.preventDefault(),localforage.setItem("userToken",null),localforage.setItem("userName",null),localforage.setItem("baseURL",null),localforage.setItem("user",null),XIGENTIMER.reset(),XIGENTIMER.VIEWMODEL.reset(!0),$(".login").fadeIn(200)}),n=function(){a.text("Incorrect login, try again :)"),a.addClass("alert"),setTimeout(function(){a.text(e).removeClass("alert")},1500)},$("[data-login]").on("submit",function(t){t.preventDefault();var o=$("[name=password]",this).val(),i=$("[name=user]",this).val(),s=$("[name=baseURL]",this).val();e=a.text(),a.text("Logging in..."),i&&o&&s?localforage.setItem("baseURL",s).then(XIGENTIMER.authoriseUser(i,o,function(t,o){t?(a.text(e),localforage.setItem("user",t),localforage.setItem("userToken",o),localforage.setItem("userName",t.Login),localforage.setItem("baseURL",s),XIGENTIMER.VIEWMODEL.isLoggedIn(!0),XIGENTIMER.VIEWMODEL.updateFromFilters(function(){XIGENTIMER.updateDatePickers()}),XIGENTIMER.API.pulse(),setTimeout(function(){XIGENTIMER.API.pulse()},3e4)):n()})):n()}),localforage.getItem("userToken",function(e){localforage.getItem("baseURL",function(t){e&&t?XIGENTIMER.authoriseUser(function(){XIGENTIMER.VIEWMODEL.isLoggedIn(!0),XIGENTIMER.VIEWMODEL.updateFromFilters(function(){XIGENTIMER.updateDatePickers()}),XIGENTIMER.API.pulse(),setTimeout(function(){XIGENTIMER.API.pulse()},3e4)}):$(".login").fadeIn(200)})}),$(".do-reset").on("click",function(){XIGENTIMER.reset()}),$(".do-viewonline").on("click",function(){localforage.getItem("baseURL",function(e){e=e.replace("/rest/v1/",""),XIGENTIMER.launchExternal(e+"/TaskDetails.aspx?ID="+XIGENTIMER.VIEWMODEL.selectedProject())})}),$("body").on("click","a",function(e){"_system"===$(this).attr("target")&&(e.preventDefault(),XIGENTIMER.launchExternal($(this).attr("href")))}),XIGENTIMER.BREADCRUMB_CONTAINER=$(".breadcrumbs"),XIGENTIMER.BREADCRUMB_EMPTY=$(".breadcrumbs").contents(),$(".time-table").on("click",".button",function(){XIGENTIMER.editTimeLog($(this).parents("tr").attr("data-id"),this)}),$(".icon-min").on("click",function(){XIGENTIMER.minimize()}),$(".icon-hide").on("click",function(){XIGENTIMER.goToTray()}),$(".icon-close").on("click",function(){XIGENTIMER.close()}),$(".do-refresh").on("click",function(){XIGENTIMER.VIEWMODEL.updateFromFilters(function(){$(".do-refresh").removeClass("is-refreshing").removeAttr("disabled")}),XIGENTIMER.updateDatePickers()})});