$(function(){"use strict";function e(e,t){console.log("Authorizing (level 1) with "+e),console.log("Authorizing (level 1) with user "+t),XIGENTIMER.API.authorizeUser(e,t,function(e){e?(localforage.setItem("user",e),$("[data-avatar]").find("img").remove(),$("[data-avatar]").prepend("<img src='"+s+"&h="+e.AvatarHash+"&id="+e.UserID+"'/>"),a(),o.isLoggedOut(!1),o.isLoggedIn(!0)):(c.text("Incorrect login, try again! :)").addClass("warning").removeClass("info"),setTimeout(function(){c.text(n).addClass("info").removeClass("warning")},3e3))})}function t(e){var t=$(document.createElement("ul"));return $.each(e,function(){t.append("<li data-id='"+this.TaskID+"'><a href='#'>"+this.Name+"</a></li>")}),t}function a(){XIGENTIMER.API.getProjects(function(e){var a,n,o,s=$(".side-nav"),l=document.createDocumentFragment();s.empty(),console.log(e),$.each(e.filter(function(e){return e.Activities.length>0}),function(e,i){a=$(document.createElement("li")),a.append("<span>"+i.Name+"</span>"),i.Activities&&i.Activities.length>0&&(n=$(document.createElement("ul")),$.each(i.Activities.filter(function(e){return!e.isHidden&&e.Progress<100}),function(e,a){console.log(a),a.Activities?(o=$("<li data-id='"+a.TaskID+"'><span>"+a.Name+"</span></li>"),o.append(t(a.Activities)),n.append(o)):n.append("<li data-id='"+a.TaskID+"'><a href='#'>"+a.Name+"</a></li>")}),a.append(n)),l.appendChild(a[0])}),s[0].appendChild(l),i()})}function i(){$(".side-nav li ul").hide(),$(".side-nav li").each(function(){$(this).children("span").on("click",function(){$(this).toggleClass("is-open"),$(this).parent("li").children("ul").toggle()})}),$(".side-nav li a").each(function(){var e=$(".breadcrumbs"),t=[];$(this).on("click",function(){t.push($(this).text()),$(this).parents("li").each(function(){t.push($(this).find("span").first().text())}),t=t.filter(function(e){return""!==e}).reverse(),e.empty(),$(t).each(function(a){a!==t.length-1?e.append("<li class='unavailable'><a href='#'>"+this+"</a></li>"):e.append("<li class='current'><a href='#'>"+this+"</a></li>")})})})}var n,o,s="http://projects.xigen.co.uk/ImagePage.aspx?t=0",l=$(".timer").FlipClock({autoStart:!1}),r=!1,c=$(".login [type=submit]");$(document).foundation(),XIGENTIMER.loginForm=function(){this.isLoggedIn=ko.observable(!1),this.isLoggedOut=ko.observable(!0),localforage.getItem("authToken",function(t){t&&localforage.getItem("userName",function(a){a&&t&&e(t,a)})}),$("[data-login]").on("submit",function(t){t.preventDefault();var a,i=$("[name=password]",this).val(),o=$("[name=user]",this).val();n=c.text(),a="Basic "+new Buffer(o+":"+i).toString("base64"),localforage.setItem("authToken",a),localforage.setItem("userName",o),c.text("Logging in..."),e(a,o)}),$("[data-logout]").on("click",function(e){e.preventDefault(),localforage.setItem("authToken",null),localforage.setItem("userName",null),$("[data-login]")[0].reset(),o.isLoggedOut(!0),o.isLoggedIn(!1),c.text(n)})},o=new XIGENTIMER.loginForm,ko.applyBindings(o),$(".do-timestart").on("click",function(){r?(r=!1,$(".do-timestart").text("Start (Timer Paused)"),l.stop(),console.log(l.getTime()),l.getTime().time>0?$(".do-send").removeAttr("disabled"):$(".do-send").attr("disabled","disabled")):(r=!0,$(".do-timestart").addClass("alert").removeClass("success"),$(".do-send").attr("disabled","disabled"),$(".do-timestart").text("Pause"),l.start())})});