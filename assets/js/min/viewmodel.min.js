!function(){"use strict";var e=require("os");XIGENTIMER.ViewModel=function(){var s=this;this.isLoggedIn=ko.observable(!1),this.isLoggedOut=ko.computed(function(){return!s.isLoggedIn()}),this.selectedProject=ko.observable(!1),this.isTiming=ko.observable(!1),this.activityDesc=ko.observable(""),this.isEditingTime=ko.observable(!1),this.isRestoringTime=ko.observable(!1),this.isViewingTasks=ko.observable(!1),this.taskTypeID=ko.observable(1),this.isOverview=ko.computed(function(){return!s.isEditingTime()&&s.isLoggedIn()&&!s.isRestoringTime()&&!s.isViewingTasks()}),this.dummy=ko.observable(),this.hasProjectSelected=ko.computed(function(){return!!s.selectedProject()}),this.canEdit=ko.computed(function(){return!s.isTiming()}),this.canSendTime=ko.computed(function(){return s.dummy(),!!s.activityDesc()&&!s.isTiming()&&XIGENTIMER.TIMER.getTime().time-1>0&&s.hasProjectSelected()&&s.isConnected()}),this.markText=ko.computed(function(){switch(s.taskTypeID()){case 1:return"Send for internal review";case 2:return"Mark as fixed";default:return"Send for internal review"}}),this.showMarkComplete=ko.computed(function(){return 3!==s.taskTypeID()}),this.notOSX=!/darwin/.test(e.platform()),this.supressChangeOne=ko.observable(!0),this.supressChangeTwo=ko.observable(!0),this.showReviewItems=ko.observable(!1),localforage.getItem("showReviewItems",function(e){e&&s.showReviewItems(e),s.supressChangeOne(!1)}),this.showInfiniteItems=ko.observable(!1),localforage.getItem("showInfiniteItems",function(e){e&&s.showInfiniteItems(e),s.supressChangeTwo(!1)}),this.showReviewItems.subscribe(function(e){s.supressChangeOne()?s.supressChangeOne(!1):(e===!0?$("body").addClass("show-review"):$("body").removeClass("show-review"),localforage.setItem("showReviewItems",e),s.updateFromFilters())}),this.showInfiniteItems.subscribe(function(e){s.supressChangeTwo()?s.supressChangeTwo(!1):(e===!0?$("body").addClass("show-infinite"):$("body").removeClass("show-infinite"),localforage.setItem("showInfiniteItems",e),s.updateFromFilters())}),this.updateFromFilters=function(e){var i=s.showReviewItems(),t=s.showInfiniteItems();$(".do-refresh").addClass("is-refreshing").attr("disabled","disabled"),XIGENTIMER.drawProjects(function(){$(".do-refresh").removeClass("is-refreshing").removeAttr("disabled"),"function"==typeof e&&e()},i,t)},this.selectTiming=function(){s.isEditingTime(!0),s.isRestoringTime(!1)},this.selectOverview=function(){s.isEditingTime(!1),s.isRestoringTime(!1),s.isViewingTasks(!1)},this.selectRestore=function(){s.isEditingTime(!1),s.isRestoringTime(!0),s.isViewingTasks(!1)},this.selectTasks=function(){s.isEditingTime(!1),s.isRestoringTime(!1),s.isViewingTasks(!0)},this.recalcCanSend=function(){s.dummy.notifySubscribers()},this.reset=function(e){e&&(s.isLoggedIn(!1),s.isEditingTime(!1)),s.activityDesc(""),s.isTiming(!1),s.recalcCanSend(),s.selectedProject(!1)},this.isConnected=ko.observable(!1),this.isChecking=ko.observable(!1),this.connectedText=ko.computed(function(){return s.isConnected()&&!s.isChecking()?"Connected to System":s.isChecking()?"Checking pulse...":"Not Connected."}),this.checkPulse=function(){XIGENTIMER.API.pulse()},this.savedStates=ko.observableArray([]),localforage.getItem("savedStates",function(e){e&&s.savedStates(e)}),this.saveState=function(){XIGENTIMER.STATE.save()},this.savedStates.subscribe(function(e){localforage.setItem("savedStates",e)}),this.canSaveState=ko.computed(function(){return!s.isTiming()&&s.hasProjectSelected()}),this.taskList=ko.observableArray([]),this.priorities={5:"<strong>Mission Critical</strong>",4:"Urgent",3:"High",2:"Medium",1:"Low"}},$(function(){XIGENTIMER.VIEWMODEL=new XIGENTIMER.ViewModel,ko.applyBindings(XIGENTIMER.VIEWMODEL)})}(XIGENTIMER);