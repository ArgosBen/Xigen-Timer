!function(){"use strict";function t(t,e){var n,a,r,i,o;localforage.getItem("activityCache",function(e){n=e.filter(function(e){return e.TaskID===t})[0],n&&(a=n.Name,i=n.EntityBaseID,o())}),o=function(){localforage.getItem("projectCache",function(t){n=t.filter(function(t){return t.ProjectID===n.ProjectID})[0],r=n.Name,e([a,r,i])})}}function e(){var t=new Date;return[t.getFullYear(),1===t.getMonth().toString().length?"0"+(t.getMonth()+1):t.getMonth()+1,1===t.getDate().toString().length?"0"+t.getDate():t.getDate()].join("-")}var n={TABLE_CLASS:".time-table",TEXT_EDIT:"Edit",TEXT_SAVE:"Save",TEXT_SAVING:"Saving..."};XIGENTIMER.renderTimeLogs=function(a){XIGENTIMER.API.getTimelogs(function(r){var i,o,d,s,c=$(n.TABLE_CLASS+" tbody"),u=(e(),0),m=document.createDocumentFragment();if(r=r.filter(function(t){return o=+moment(t.EntryDate,"YYYY-MM-DD/HH:mm:ss.SS"),"Locked"!==t.Locked&&o>a[0]&&o<a[1]}).sort(function(t,e){return d=+moment(t.EntryDate,"YYYY-MM-DD/HH:mm:ss.SS"),s=+moment(e.EntryDate,"YYYY-MM-DD/HH:mm:ss.SS"),s>d?-1:d>s?1:0}).reverse(),r.length>0)$.each(r,function(e){t(this.TaskID,function(t){i=t;var a=document.createElement("tr");a.setAttribute("data-id",r[e].EntityBaseID),a.setAttribute("data-taskId",r[e].TaskID),o=moment(r[e].EntryDate,"YYYY-MM-DD/HH:mm:ss.SS"),$(a).append("<td><strong>"+o.calendar()+"</strong><br/>("+o.format("DD-MM-YYYY")+")</td>"),$(a).append("<td><strong>"+i[1]+":</strong><br/><a target='_system' href='http://projectsvm.xigen.co.uk/TaskDetails.aspx?ID="+i[2]+"'>"+i[0]+"</a></td>"),$(a).append("<td>"+r[e].Duration.toFixed(2)+"</td>"),$(a).append("<td>"+r[e].Description+"</td>"),$(a).append("<td><button class='button tiny success expand'>"+n.TEXT_EDIT+"</button></td>"),m.appendChild(a),u+=1,u===r.length&&(c.empty(),c[0].appendChild(m))})});else{var l=document.createElement("tr");$(l).append("<td align='center' colspan='4'><strong>No time logged for these dates - Do some work!</strong></td>"),m.appendChild(l),c.empty(),c[0].appendChild(m)}})},XIGENTIMER.editTimeLog=function(t,e){var a=$(n.TABLE_CLASS+" tbody").find("[data-id='"+t+"']"),r=(a.attr("data-taskId"),a.find("td").eq(3)),i=a.find("td").eq(2),o=r.text(),d=i.text(),s=/[0-9]{1,2}\.[0-9]{1,2}/,c=!0;e.jquery||(e=$(e)),i.html("<input maxlength='5' type='text' value='"+d+"' />"),r.html("<textarea>"+o+"</textarea>"),e.text(n.TEXT_SAVE),e.on("click",function(){o=r.find("textarea").val(),d=i.find("input").val(),s.test(d)||(i.find("input").addClass("error"),c=!1,i.find("input").on("keyup",function(){s.test($(this).val())?(i.find("input").removeClass("error"),c=!0):i.find("input").addClass("error")})),c&&(e.attr("disabled","disabled"),e.text(n.TEXT_SAVING),XIGENTIMER.API.updateTimeLog(t,d,o,function(){r.html(o),i.html(d),e.removeAttr("disabled"),e.text(n.TEXT_EDIT),e.off("click")}))})},XIGENTIMER.updateDatePickers=function(){var t=$("[data-start]").data("picker"),e=$("[data-end]").data("picker"),n=[];e.setMinDate(t.getDate()),t.setMaxDate(e.getDate()),n.push(+t.getDate()),n.push(+e.getDate()),XIGENTIMER.renderTimeLogs(n)}}();