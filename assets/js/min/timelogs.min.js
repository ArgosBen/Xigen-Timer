!function(){function t(t,e){function n(){localforage.getItem("projectCache",function(t){a=t.filter(function(t){return t.ProjectID===a.ProjectID})[0],o=a.Name,e([i,o,r])})}var a,i,o,r;localforage.getItem("activityCache",function(e){a=e.filter(function(e){return e.TaskID===t})[0],i=a.Name,r=a.EntityBaseID}).then(n)}var e={TABLE_CLASS:".time-table",TEXT_EDIT:"Edit",TEXT_SAVE:"Save",TEXT_SAVING:"Saving..."};getTodaysDate=function(){var t=new Date;return formattedDate=[t.getFullYear(),1===t.getMonth().toString().length?"0"+(t.getMonth()+1):t.getMonth()+1,1===t.getDate().toString().length?"0"+t.getDate()-1:t.getDate()-1].join("-")},XIGENTIMER.renderTimeLogs=function(){XIGENTIMER.API.getTimelogs(function(n){var a,i=$(e.TABLE_CLASS+" tbody"),o=getTodaysDate(),r=0,d=document.createDocumentFragment();n=n.filter(function(t){return"Locked"!==t.Locked&&t.EntryDate.indexOf(o)>-1}).reverse(),$.each(n,function(o){t(this.TaskID,function(t){a=t;var c=document.createElement("tr");c.setAttribute("data-id",n[o].EntityBaseID),c.setAttribute("data-taskId",n[o].TaskID),$(c).append("<td><strong>"+a[1]+":</strong><br/><a target='_system' href='http://projectsvm.xigen.co.uk/TaskDetails.aspx?ID="+a[2]+"'>"+a[0]+"</a></td>"),$(c).append("<td>"+n[o].Duration.toFixed(2)+"</td>"),$(c).append("<td>"+n[o].Description+"</td>"),$(c).append("<td><button class='button tiny success expand'>"+e.TEXT_EDIT+"</button></td>"),d.appendChild(c),r+=1,r===n.length&&(i.empty(),i[0].appendChild(d))})})})},XIGENTIMER.editTimeLog=function(t,n){console.log(t);var a=$(e.TABLE_CLASS+" tbody").find("[data-id='"+t+"']"),i=(a.attr("data-taskId"),a.find("td").eq(2)),o=a.find("td").eq(1),r=i.text(),d=o.text(),c=/[0-9]{1,2}\.[0-9]{1,2}/,s=!0;n.jquery||(n=$(n)),o.html("<input type='text' value='"+d+"' />"),i.html("<textarea>"+r+"</textarea>"),n.text(e.TEXT_SAVE),n.on("click",function(){n.attr("disabled","disabled"),n.text(e.TEXT_SAVING),r=i.find("textarea").val(),d=o.find("input").val(),c.test(d)||(o.find("input").addClass("error"),s=!1,o.find("input").on("keyup",function(){c.test($(this).val())?(o.find("input").removeClass("error"),s=!0):o.find("input").addClass("error")})),s&&XIGENTIMER.API.updateTimeLog(t,d,r,function(){i.html(r),o.html(d),n.removeAttr("disabled"),n.text(e.TEXT_EDIT),n.off("click")})})},$(e.TABLE_CLASS).length&&XIGENTIMER.renderTimeLogs()}();