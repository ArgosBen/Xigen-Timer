"object"!=typeof XIGENTIMER&&(XIGENTIMER={}),function(t){"use strict";var e,n=require("node-rest-client").Client,i=new n;t.API={base:function(t,n,o,a){var r,s,c,u,f,l,g,I={};r=function(){localforage.getItem("user",function(t){f=t.UserID,l=t.Name,I.headers={Authorization:s,"Content-Type":"application/json"},o&&(I.data="object"==typeof o?JSON.stringify(o):o)}).then(c)},c=function(){i[t.toLowerCase()](e+n,I,function(t,e){t=JSON.parse(t),t.length||(t=[t]),g=t[0].UserID?t.filter(function(t){return t.UserID===f}):t[0].Members?t.filter(function(t){return t.Members.split("\n").indexOf(l)>-1}):t.filter(function(t){return t.CanCreateTimeEntries}),"function"==typeof a&&(200===e.statusCode||201===e.statusCode?a(!0,g):a(!1))})},u=function(){localforage.getItem("authToken",function(t){s=t}).then(r)},e?u():localforage.getItem("baseURL",function(t){e=t}).then(u)},authorizeUser:function(t,n,o){var a,r=!1;localforage.getItem("baseURL",function(t){e=t,t?a():o(!1)}),a=function(){i.get(e+"users",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){t?($.each(JSON.parse(t),function(t,e){return e.Login.toLowerCase()===n.toLowerCase()?(localforage.setItem("user",e),r=e,!1):void 0}),"function"==typeof o&&o(r)):"function"==typeof o&&o(!1)})}},getHierachy:function(e){var n,i=[],o={},a=0;n=function(t){var e,n=[],i=[];return n=t.filter(function(t){return t.HasChild>0}),i=t.filter(function(t){return t.ParentID}),$.each(n,function(t,o){e=o.EntityBaseID,n[t].Activities=[],n[t].Activities=i.filter(function(t,n){return t.ParentID===e?(i.splice(n,1),!0):void 0})}),n.filter(function(t){return null===t.ParentID})},t.API.base("GET","projects",{},function(r,s){i=s,$.each(s,function(r,s){s.Activities=[],o[s.EntityBaseID]=this,t.API.base("GET","projects/"+s.EntityBaseID+"/activities",{},function(t,r){a+=1,o[s.EntityBaseID].Activities=n(r),a===i.length&&e(o)})})})},getTimelogs:function(e){t.API.base("GET","timelogs",{},function(t,n){e(n)})},logTime:function(e,n,i,o,a,r){var s,c,u=new Date;c=[u.getFullYear(),"-",1===u.getMonth().toString().length?"0"+(u.getMonth()+1):u.getMonth()+1,"-",1===u.getDate().toString().length?"0"+u.getDate():u.getDate(),"T",u.getHours(),":",1===u.getMinutes().toString().length?"0"+u.getMinutes():u.getMinutes(),":",1===u.getSeconds().toString().length?"0"+u.getSeconds():u.getSeconds()].join(""),t.API.base("POST","timelogs",{UserID:s.UserID,Duration:i,TaskID:n,Description:a,Billable:o,EntryDate:c},function(t,e){r(e)})},markForReview:function(e,n){var i,o,a;localforage.getItem("activityCache",function(t){a=t.filter(function(t){return t.TaskID===e})[0],o=a.TaskTypeID}).then(i),i=function(){t.API.base("PUT","activities/"+e,{EntityBaseID:e,TaskStatusID:1===o?18:8},function(t){n(t)})}},updateTimeLog:function(t,n,o,a){var r,s,c,u,f=!1;c=function(){i.get(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"}},function(t){u=JSON.parse(t),u.Duration!==n&&(f=!0,u.Duration=parseFloat(n)),u.Description!==o&&(f=!0,u.Description=o),delete u.LastModificationDate,f?s():a(!0)})},s=function(){i.put(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"},data:JSON.stringify(u)},function(t,e){"function"==typeof a&&a(200===e.statusCode)})},localforage.getItem("authToken",function(t){r=t}).then(c)}}}(XIGENTIMER);