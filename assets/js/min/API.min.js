"object"!=typeof XIGENTIMER&&(XIGENTIMER={}),function(t){"use strict";var e=require("node-rest-client").Client,i="http://projects.xigen.co.uk/rest/v1/",n=new e,o={userID:0,email:"matt@xigen.co.uk"};t.API={authorizeUser:function(t,e,o){console.log("Authorizing (level 2) with "+t),console.log("Authorizing (level 2) with user "+e);var r=!1;n.get(i+"users",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){t?($.each(JSON.parse(t),function(t,i){return i.Login.toLowerCase()===e.toLowerCase()?(localforage.setItem("user",i),r=i,!1):void 0}),"function"==typeof o&&o(r)):"function"==typeof o&&o(!1)})},getProjects:function(t){var e,o=0;localforage.getItem("authToken",function(r){n.get(i+"projects",{headers:{Authorization:r,"Content-Type":"application/json"}},function(a){localforage.getItem("user",function(s){var c=a?JSON.parse(a):[],u=c.filter(function(t){return t.Members.split("\n").indexOf(s.Name)>-1});e=u.length,$(u).each(function(a){var s=this;n.get(i+"projects/"+s.ProjectID+"/activities/",{headers:{Authorization:r,"Content-Type":"application/json"}},function(i){var n,r=JSON.parse(i),s=0;o+=1,$.each(r,function(){var t=this;this.ParentID&&(n=r.filter(function(e){return e.EntityBaseID===t.ParentID})[0],n.Activities||(n.Activities=[]),n.Activities.push(t),t.isHidden=!0),s+=1}),u[a].Activities=r,"function"==typeof t&&o===e&&t(u)})})})})})},getActivities:function(){localforage.getItem("authToken",function(t){n.get(i+"activities",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){console.log(JSON.parse(t))})})},getTimelogs:function(){n.get(i+"timelogs",{headers:{Authorization:"Basic bWF0dG06NmdyZWVuY2F0","Content-Type":"application/json"}},function(t){var e=JSON.parse(t).filter(function(t){return t.UserID===o.userID});$.each(e,function(){$("body").append("<p>"+this.Duration+" hours doing task: "+this.Description+"</p>")})})}}}(XIGENTIMER);