"object"!=typeof XIGENTIMER&&(XIGENTIMER={}),function(t){"use strict";var e,n=require("node-rest-client").Client,o=new n;t.API={base:function(t,n,i,a){var r,s,c,u,f,g,l,h={};r=function(){localforage.getItem("user",function(t){f=t.UserID,g=t.Name,h.headers={Authorization:s,"Content-Type":"application/json"},i&&(h.data="object"==typeof i?JSON.stringify(i):i)}).then(c)},c=function(){console.log("getting "+e+n),o[t.toLowerCase()](e+n,h,function(t,e){t=JSON.parse(t),t.length||(t=[t]),l=t[0].UserID?t.filter(function(t){return t.UserID===f}):t[0].Members?t.filter(function(t){return t.Members.split("\n").indexOf(g)>-1}):t.filter(function(t){return t.CanCreateTimeEntries}),"function"==typeof a&&(200===e.statusCode||201===e.statusCode?a(!0,l):a(!1))})},u=function(){localforage.getItem("authToken",function(t){s=t}).then(r)},e?u():localforage.getItem("baseURL",function(t){e=t}).then(u)},authorizeUser:function(t,n,i){var a,r=!1;localforage.getItem("baseURL",function(t){e=t,t?a():i(!1)}),a=function(){o.get(e+"users",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){t?($.each(JSON.parse(t),function(t,e){return e.Login.toLowerCase()===n.toLowerCase()?(localforage.setItem("user",e),r=e,!1):void 0}),"function"==typeof i&&i(r)):"function"==typeof i&&i(!1)})}},getHierachy:function(){var e,n=[],o={},i=0;e=function(t){var e,n,o,i=[],a=[];return i=t.filter(function(t){return t.HasChild>0&&!t.ParentID}),a=t.filter(function(t){return t.HasChild<=0&&t.ParentID}),$.each(a,function(){e=this.ParentID,n=i.filter(function(t,n){t.EntityBaseID===e&&(o=n)}),t[o].Activities||(t[o].Activities=[]),t[o].HasChild=0,t[o].Activities.push(this)}),i},t.API.base("GET","projects",{},function(a,r){n=r,$.each(r,function(a,r){r.Activities=[],o[r.EntityBaseID]=this,t.API.base("GET","projects/"+r.EntityBaseID+"/activities",{},function(t,a){i+=1,o[r.EntityBaseID].Activities=e(a),i===n.length&&console.log(o)})})})},getTimelogs:function(t){var n,i,a,r;a=function(){localforage.getItem("user",function(t){i=t.UserID}).then(r)},r=function(){o.get(e+"timelogs",{headers:{Authorization:n,"Content-Type":"application/json"}},function(e){var n=JSON.parse(e).filter(function(t){return t.UserID===i});"function"==typeof t&&t(n)})},localforage.getItem("authToken",function(t){n=t}).then(a)},logTime:function(t,n,i,a,r,s){var c,u,f,g,l,h=new Date;l=[h.getFullYear(),"-",1===h.getMonth().toString().length?"0"+(h.getMonth()+1):h.getMonth()+1,"-",1===h.getDate().toString().length?"0"+h.getDate():h.getDate(),"T",h.getHours(),":",1===h.getMinutes().toString().length?"0"+h.getMinutes():h.getMinutes(),":",1===h.getSeconds().toString().length?"0"+h.getSeconds():h.getSeconds()].join(""),c=function(){localforage.getItem("user",function(t){g=t}).then(f)},f=function(){o.post(e+"timelogs",{headers:{Authorization:u,"Content-Type":"application/json"},data:JSON.stringify({UserID:g.UserID,Duration:i,TaskID:n,Description:r,Billable:a,EntryDate:l})},function(t,e){"function"==typeof s&&s(201===e.statusCode)})},localforage.getItem("authToken",function(t){u=t}).then(c)},markForReview:function(t,n){var i,a,r,s,c;s=function(){localforage.getItem("activityCache",function(e){c=e.filter(function(e){return e.TaskID===t})[0],r=c.TaskTypeID}).then(a)},a=function(){o.put(e+"activities/"+t,{headers:{Authorization:i,"Content-Type":"application/json"},data:JSON.stringify({EntityBaseID:t,TaskStatusID:1===r?18:8})},function(t,e){"function"==typeof n&&n(200===e.statusCode)})},localforage.getItem("authToken",function(t){i=t}).then(s)},updateTimeLog:function(t,n,i,a){var r,s,c,u,f=!1;c=function(){o.get(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"}},function(t){u=JSON.parse(t),u.Duration!==n&&(f=!0,u.Duration=parseFloat(n)),u.Description!==i&&(f=!0,u.Description=i),delete u.LastModificationDate,f?s():a(!0)})},s=function(){o.put(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"},data:JSON.stringify(u)},function(t,e){"function"==typeof a&&a(200===e.statusCode)})},localforage.getItem("authToken",function(t){r=t}).then(c)}}}(XIGENTIMER);