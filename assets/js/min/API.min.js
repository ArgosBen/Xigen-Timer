"object"!=typeof XIGENTIMER&&(XIGENTIMER={}),function(t){"use strict";var e,n=require("node-rest-client").Client,o=new n;t.API={base:function(t,n,i,a){var r,u,c,s,f,l,g,p={};r=function(){localforage.getItem("user",function(t){f=t.UserID,l=t.Name,p.headers={Authorization:u,"Content-Type":"application/json"},i&&(p.data="object"==typeof i?JSON.stringify(i):i)}).then(c)},c=function(){o[t.toLowerCase()](e+n,p,function(t,e){t=JSON.parse(t),t.length||(t=[t]),g=t[0].UserID?t.filter(function(t){return t.UserID===f}):t[0].Members?t.filter(function(t){return t.Members.split("\n").indexOf(l)>-1}):t.filter(function(t){return t.CanCreateTimeEntries}),"function"==typeof a&&(200===e.statusCode||201===e.statusCode?a(!0,g):a(!1))})},s=function(){localforage.getItem("authToken",function(t){u=t}).then(r)},e?s():localforage.getItem("baseURL",function(t){e=t}).then(s)},authorizeUser:function(t,n,i){var a,r=!1;localforage.getItem("baseURL",function(t){e=t,t?a():i(!1)}),a=function(){o.get(e+"users",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){t?($.each(JSON.parse(t),function(t,e){return e.Login.toLowerCase()===n.toLowerCase()?(localforage.setItem("user",e),r=e,!1):void 0}),"function"==typeof i&&i(r)):"function"==typeof i&&i(!1)})}},getHierachy:function(e){var n,o=[],i={},a=0;n=function(t){var e,n=[],o=[];return n=t.filter(function(t){return t.HasChild>0}),o=t.filter(function(t){return t.ParentID}),$.each(n,function(t,i){e=i.EntityBaseID,n[t].Activities=[],n[t].Activities=o.filter(function(t,n){return t.ParentID===e?(o.splice(n,1),!0):void 0})}),n.filter(function(t){return null===t.ParentID})},t.API.base("GET","projects",{},function(r,u){o=u,$.each(u,function(r,u){u.Activities=[],i[u.EntityBaseID]=this,t.API.base("GET","projects/"+u.EntityBaseID+"/activities",{},function(t,r){a+=1,i[u.EntityBaseID].Activities=n(r),a===o.length&&e(i)})})})},getTimelogs:function(t){var n,i,a,r;a=function(){localforage.getItem("user",function(t){i=t.UserID}).then(r)},r=function(){o.get(e+"timelogs",{headers:{Authorization:n,"Content-Type":"application/json"}},function(e){var n=JSON.parse(e).filter(function(t){return t.UserID===i});"function"==typeof t&&t(n)})},localforage.getItem("authToken",function(t){n=t}).then(a)},logTime:function(t,n,i,a,r,u){var c,s,f,l,g,p=new Date;g=[p.getFullYear(),"-",1===p.getMonth().toString().length?"0"+(p.getMonth()+1):p.getMonth()+1,"-",1===p.getDate().toString().length?"0"+p.getDate():p.getDate(),"T",p.getHours(),":",1===p.getMinutes().toString().length?"0"+p.getMinutes():p.getMinutes(),":",1===p.getSeconds().toString().length?"0"+p.getSeconds():p.getSeconds()].join(""),c=function(){localforage.getItem("user",function(t){l=t}).then(f)},f=function(){o.post(e+"timelogs",{headers:{Authorization:s,"Content-Type":"application/json"},data:JSON.stringify({UserID:l.UserID,Duration:i,TaskID:n,Description:r,Billable:a,EntryDate:g})},function(t,e){"function"==typeof u&&u(201===e.statusCode)})},localforage.getItem("authToken",function(t){s=t}).then(c)},markForReview:function(t,n){var i,a,r,u,c;u=function(){localforage.getItem("activityCache",function(e){c=e.filter(function(e){return e.TaskID===t})[0],r=c.TaskTypeID}).then(a)},a=function(){o.put(e+"activities/"+t,{headers:{Authorization:i,"Content-Type":"application/json"},data:JSON.stringify({EntityBaseID:t,TaskStatusID:1===r?18:8})},function(t,e){"function"==typeof n&&n(200===e.statusCode)})},localforage.getItem("authToken",function(t){i=t}).then(u)},updateTimeLog:function(t,n,i,a){var r,u,c,s,f=!1;c=function(){o.get(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"}},function(t){s=JSON.parse(t),s.Duration!==n&&(f=!0,s.Duration=parseFloat(n)),s.Description!==i&&(f=!0,s.Description=i),delete s.LastModificationDate,f?u():a(!0)})},u=function(){o.put(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"},data:JSON.stringify(s)},function(t,e){"function"==typeof a&&a(200===e.statusCode)})},localforage.getItem("authToken",function(t){r=t}).then(c)}}}(XIGENTIMER);