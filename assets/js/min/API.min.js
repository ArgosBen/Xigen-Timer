"object"!=typeof XIGENTIMER&&(XIGENTIMER={}),function(t){"use strict";var e,n=require("node-rest-client").Client,o=new n;t.API={authorizeUser:function(t,n,i){var a,r=!1;console.log("Authorising..."),localforage.getItem("baseURL",function(t){e=t,t?a():i(!1)}),a=function(){o.get(e+"users",{headers:{Authorization:t,"Content-Type":"application/json"}},function(t){t?($.each(JSON.parse(t),function(t,e){return e.Login.toLowerCase()===n.toLowerCase()?(localforage.setItem("user",e),r=e,!1):void 0}),"function"==typeof i&&i(r)):"function"==typeof i&&i(!1)})}},getProjects:function(t){var n,i=0,a=[];localforage.getItem("authToken",function(r){o.get(e+"projects",{headers:{Authorization:r,"Content-Type":"application/json"}},function(c){localforage.getItem("user",function(s){var u=c?JSON.parse(c):[],f=u.filter(function(t){return t.Members.split("\n").indexOf(s.Name)>-1});localforage.setItem("projectCache",u),n=f.length,$(f).each(function(c){var s=this;o.get(e+"projects/"+s.ProjectID+"/activities/",{headers:{Authorization:r,"Content-Type":"application/json"}},function(e){var o,r=JSON.parse(e),s=0;i+=1,a=a.concat(r),$.each(r,function(){var t=this;this.ParentID&&(o=r.filter(function(e){return e.EntityBaseID===t.ParentID})[0],o.Activities||(o.Activities=[]),o.Activities.push(t),t.isHidden=!0),s+=1}),f[c].Activities=r,i===n&&localforage.setItem("activityCache",a),"function"==typeof t&&i===n&&t(f)})})})})})},getTimelogs:function(t){var n,i,a,r;a=function(){localforage.getItem("user",function(t){i=t.UserID}).then(r)},r=function(){o.get(e+"timelogs",{headers:{Authorization:n,"Content-Type":"application/json"}},function(e){var n=JSON.parse(e).filter(function(t){return t.UserID===i});"function"==typeof t&&t(n)})},localforage.getItem("authToken",function(t){n=t}).then(a)},logTime:function(t,n,i,a,r,c){var s,u,f,g,l,p=new Date;l=[p.getFullYear(),"-",1===p.getMonth().toString().length?"0"+(p.getMonth()+1):p.getMonth()+1,"-",1===p.getDate().toString().length?"0"+p.getDate():p.getDate(),"T",p.getHours(),":",1===p.getMinutes().toString().length?"0"+p.getMinutes():p.getMinutes(),":",1===p.getSeconds().toString().length?"0"+p.getSeconds():p.getSeconds()].join(""),s=function(){localforage.getItem("user",function(t){g=t}).then(f)},f=function(){o.post(e+"timelogs",{headers:{Authorization:u,"Content-Type":"application/json"},data:JSON.stringify({UserID:g.UserID,Duration:i,TaskID:n,Description:r,Billable:a,EntryDate:l})},function(t,e){"function"==typeof c&&c(201===e.statusCode)})},localforage.getItem("authToken",function(t){u=t}).then(s)},markForReview:function(t,n){var i,a,r,c,s;c=function(){localforage.getItem("activityCache",function(e){s=e.filter(function(e){return e.TaskID===t})[0],r=s.TaskTypeID}).then(a)},a=function(){o.put(e+"activities/"+t,{headers:{Authorization:i,"Content-Type":"application/json"},data:JSON.stringify({EntityBaseID:t,TaskStatusID:1===r?18:8})},function(t,e){"function"==typeof n&&n(200===e.statusCode)})},localforage.getItem("authToken",function(t){i=t}).then(c)},updateTimeLog:function(t,n,i,a){var r,c,s,u,f=!1;s=function(){o.get(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"}},function(t){u=JSON.parse(t),u.Duration!==n&&(f=!0,u.Duration=parseFloat(n)),u.Description!==i&&(f=!0,u.Description=i),delete u.LastModificationDate,f?c():a(!0)})},c=function(){o.put(e+"timelogs/"+t,{headers:{Authorization:r,"Content-Type":"application/json"},data:JSON.stringify(u)},function(t,e){"function"==typeof a&&a(200===e.statusCode)})},localforage.getItem("authToken",function(t){r=t}).then(s)}}}(XIGENTIMER);